<!-- TOC -->

- [Oracle环境](#oracle环境)
    - [Oracle Server安装](#oracle-server安装)
    - [新建实例](#新建实例)
    - [配置监听](#配置监听)
    - [OEM](#oem)
        - [未注册监听](#未注册监听)
        - [EM相关账户解锁](#em相关账户解锁)
        - [实例化OC4J配置文件是出错](#实例化oc4j配置文件是出错)
    - [用户操作](#用户操作)
    - [Enterprise Manager (EM) Database Control](#enterprise-manager-em-database-control)
    - [客户端的安装](#客户端的安装)
    - [PL/SQL developer](#plsql-developer)
    - [疑难解答](#疑难解答)
        - [ORA-12541](#ora-12541)

<!-- /TOC -->

<a id="markdown-oracle环境" name="oracle环境"></a>
# Oracle环境
<a id="markdown-oracle-server安装" name="oracle-server安装"></a>
## Oracle Server安装
下载 http://www.oracle.com/technetwork/cn/database/enterprise-edition/downloads/index.html

按照默认过程进行安装即可，以下为对应步骤的图示：

![](..\assets\Oracle\oracle-install-1.png)

![](..\assets\Oracle\oracle-install-2.png)

![](..\assets\Oracle\oracle-install-3.png)

![](..\assets\Oracle\oracle-install-4.png)

![](..\assets\Oracle\oracle-install-6.png)

在安装过程中会出现一些异常信息，暂时不用管，直接【继续】即可。

![](..\assets\Oracle\oracle-client-install-6-errinfo.png)

<a id="markdown-新建实例" name="新建实例"></a>
## 新建实例
开始菜单中打开【Oracle-OraDb11g_home1】-【配置和移植工具】-【DataBase Configuration Assistant】数据库配置助手进行新建实例

![](..\assets\Oracle\oracle-db-create-config.png)

![](..\assets\Oracle\oracle-db-create-0.png)

![](..\assets\Oracle\oracle-db-create-1.png)

![](..\assets\Oracle\oracle-db-create-2.png)

![](..\assets\Oracle\oracle-db-create-3.png)

![](..\assets\Oracle\oracle-db-create-4.png)

![](..\assets\Oracle\oracle-db-create-5.png)

![](..\assets\Oracle\oracle-db-create-6.png)

![](..\assets\Oracle\oracle-db-create-7.png)

![](..\assets\Oracle\oracle-db-create-8.png)

![](..\assets\Oracle\oracle-db-create-9.png)

![](..\assets\Oracle\oracle-db-create-10.png)

![](..\assets\Oracle\oracle-db-create-11.png)

![](..\assets\Oracle\oracle-db-create-12.png)

安装过程较为耗时，正在安装中。。。

![](..\assets\Oracle\oracle-db-create-ing.png)

安装完成【退出】即可

![](..\assets\Oracle\oracle-db-create-finish.png)

<a id="markdown-配置监听" name="配置监听"></a>
## 配置监听
开始菜单中打开【Oracle-OraDb11g_home1】-【配置和移植工具】-【Net Configuration Assistant】网络配置

![](..\assets\Oracle\oracle-net-config-assistant.png)

选择【监听程序】进行配置

![](..\assets\Oracle\oracle-net-listen-1.png)

![](..\assets\Oracle\oracle-net-listen-2.png)

![](..\assets\Oracle\oracle-net-listen-3.png)

![](..\assets\Oracle\oracle-net-listen-4.png)

![](..\assets\Oracle\oracle-net-listen-5.png)

![](..\assets\Oracle\oracle-net-listen-6.png)

![](..\assets\Oracle\oracle-net-listen-7.png)

![](..\assets\Oracle\oracle-net-listen-8.png)

再进行【本地网络服务名】的配置

![](..\assets\Oracle\oracle-net-listen-srv-1.png)

![](..\assets\Oracle\oracle-net-listen-srv-2.png)

![](..\assets\Oracle\oracle-net-listen-srv-3.png)

![](..\assets\Oracle\oracle-net-listen-srv-4.png)

![](..\assets\Oracle\oracle-net-listen-srv-5.png)

![](..\assets\Oracle\oracle-net-listen-srv-6.png)

![](..\assets\Oracle\oracle-net-listen-srv-7.png)

![](..\assets\Oracle\oracle-net-listen-srv-8.png)

<a id="markdown-oem" name="oem"></a>
## OEM
OEM是啥。。。。。

<a id="markdown-未注册监听" name="未注册监听"></a>
### 未注册监听

使用DBCA安装OEM时可能会报错：

![](..\assets\Oracle\dbca-emca-数据库服务未注册到监听.png)

打开【Net Manager】进行监听程序-添加数据库的配置：

![](..\assets\Oracle\net-manager-监听配置-添加数据库.png)

需要注意的是【全局数据库名】和【SID】名称不要写错了，Oracle主目录为：【D:\app\123\product\11.2.0\dbhome_1】

再进行修改【tnsnames.ora】和【listener.ora】配置文件：

【tnsnames.ora】：
```sql
# tnsnames.ora Network Configuration File: D:\app\123\product\11.2.0\dbhome_1\network\admin\tnsnames.ora
# Generated by Oracle configuration tools.

# 注意监听HOST修改为ip地址
IFLYTEK =
  (DESCRIPTION =
    (ADDRESS_LIST =
      (ADDRESS = (PROTOCOL = TCP)(HOST = 172.16.123.250)(PORT = 1521))
    )
    (CONNECT_DATA =
	  (SID = IFLYTEK)
      (SERVICE_NAME = iflytek)
    )
  )

LISTENER_IFLYTEK =
  (ADDRESS = (PROTOCOL = TCP)(HOST = 172.16.123.250)(PORT = 1521))


ORACLR_CONNECTION_DATA =
  (DESCRIPTION =
    (ADDRESS_LIST =
      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))
    )
    (CONNECT_DATA =
      (SID = CLRExtProc)
      (PRESENTATION = RO)
    )
  )
```

【listener.ora】：
```sql
# listener.ora Network Configuration File: D:\app\123\product\11.2.0\dbhome_1\NETWORK\ADMIN\listener.ora
# Generated by Oracle configuration tools.

# 注意监听HOST修改为ip地址
SID_LIST_LISTENER =
  (SID_LIST =
    (SID_DESC =
      (SID_NAME = CLRExtProc)
      (ORACLE_HOME = D:\app\123\product\11.2.0\dbhome_1)
      (PROGRAM = extproc)
      (ENVS = "EXTPROC_DLLS=ONLY:D:\app\123\product\11.2.0\dbhome_1\bin\oraclr11.dll")
    )
    (SID_DESC =
      (GLOBAL_DBNAME = IFLYTEK)
      (ORACLE_HOME = D:\app\123\product\11.2.0\dbhome_1)
      (SID_NAME = iflytek)
    )
  )

LISTENER =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = 172.16.123.250)(PORT = 1521))
  )

ADR_BASE_LISTENER = D:\app\123

```

注意，设置以上更改需要进行服务的重启！

https://blog.csdn.net/dave_sunny/article/details/10467579

<a id="markdown-em相关账户解锁" name="em相关账户解锁"></a>
### EM相关账户解锁

![](..\assets\Oracle\dbca-emca-em相关账户解锁.png)

```

剧情1：郁闷的开始
使用环境：win8+oracle 11g r2
前言：不知道是何种原因（多种原因），装好的oracle没有EM，那么就需要自己配置一下
PS：配置过程出现各种各样的问题，整整弄了一个晚上，现在分享，希望大家不要再走弯路

基本步骤：
1.设置好监听器， 启动监听：lsnrctl start，查看监听状态：lsnrctl statu
2.删除dbcontrol：emca -deconfig dbcontrol db
3.删除EM资料库：emca -repos drop
4.创建新资料库：emca -repos create 
5.重新配置dbcontrol：emca -config dbcontrol db

注意：
        1.cmd要使用管理员方式(否则不能备份文件)
        2.密码不能太简单，111111即可 (无法对所有EM相关账户解锁)
        3.sys的密码 记得加权限 111111 as sysdba
        4.第五步之前请确认解锁状态（理论上需要的三个账号都是open状态）

Sql代码  
1.--解锁用户   
2.alter user scott account unlock;   
3.--查询状态   
4.select username,account_status from dba_users;   
5.--重新赋值密码   
6.alter user sys identified by 111111;  
--解锁用户
alter user scott account unlock;
--查询状态
select username,account_status from dba_users;
--重新赋值密码
alter user sys identified by 111111; 
下面这句话解决“无法对所有 EM 相关帐户解锁” 的问题(这个不知道有没有效果，如果上面方式不行，那么可尝试) 
    reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Command Processor" /v "AutoRun" /d "" /f 

运行：
    1.设置ORACLE_UNQNAME：set ORACLE_UNQNAME=ORCL  set ORACLE_SID= ORCL

    2.启动：emctl  start  dbconsole（如果上面的dbcontrol 配置成功应该是已经运行状态） 
    3.检测运行状态：emctl  status dbconsole 
    4.访问地址：https://127.0.0.1:1158/em （注意证书要确认，或者直接执行）
     5.停止：emctl  stop  dbconsole 


剧情2：发现还不行

c:>emctl start dbconsole
OC4J Configuration issue. /u01/app/oracle/product/11.2.0/dbhome_1/oc4j/j2ee/OC4J_DBConsole_test_orcl not found.

再一次
c:>emca -config dbcontrol db

这才ok!
```
> http://snkcxy.iteye.com/blog/1930506

<a id="markdown-实例化oc4j配置文件是出错" name="实例化oc4j配置文件是出错"></a>
### 实例化OC4J配置文件是出错

![](..\assets\Oracle\dbca-emca-em实例化OC4J配置出错.png)

<a id="markdown-用户操作" name="用户操作"></a>
## 用户操作
做好以上准备后，我们可以针对数据添加用户并授权，以下操作均在服务端进行

![](..\assets\Oracle\create-user-1.png)

打开sqlplus，使用安装Oracle时设置的密码进行登录：

![](..\assets\Oracle\create-user-login.png)

上图中system为默认系统用户，可以用来进行用户的相关操作

以下脚本是用户相关的操作：
```sql
-- 查看数据库中所有用户的名称;
select username from dba_users;

-- 新建用户 用户名为【new_user_name】，密码为【new_password】
create user new_user_name identified by new_password;

-- 修改用户密码 将用户【new_user_name】重置为【new_password】
alter user new_user_name identified by new_password;

-- 删除用户
drop user new_user_name;

-- 同时删除与【new_user_name】相关的表;
drop user new_user_name cascade;

//授权 
-- 登录授权;
grant connect to new_user_name;

-- scott用户为new_user_name赋予表emp的select权限;
grant select on emp to new_user_name;

-- sys用户为new_user_name赋予表emp的select权限;
grant select on scott.emp to new_user_name;

-- 授予增删改查权限
grant select,insert,delete,update on scott.emp to new_user_name;

-- 授予 CONNECT角色和RESOURCE角色
grant connect,resource to new_user_name;
```

CONNECT角色： --是授予最终用户的典型权利，最基本的
  * ALTER SESSION --修改会话
  * CREATE CLUSTER --建立聚簇
  * CREATE DATABASE LINK --建立数据库链接
  * CREATE SEQUENCE --建立序列
  * CREATE SESSION --建立会话
  * CREATE SYNONYM --建立同义词
  * CREATE VIEW --建立视图
  
RESOURCE角色： --是授予开发人员的
  * CREATE CLUSTER --建立聚簇
  * CREATE PROCEDURE --建立过程
  * CREATE SEQUENCE --建立序列
  * CREATE TABLE --建表
  * CREATE TRIGGER --建立触发器
  * CREATE TYPE --建立类型

创建用户【fly】，密码为【1】,并授予connect和resource权限
```sql
CREATE USER FLY IDENTIFIED BY 1;

GRANT CONNECT,RESOURCE TO FLY;
```

以上，即基本的用户创建和权限授予操作。

> https://blog.csdn.net/love_legain/article/details/54291400

<a id="markdown-enterprise-manager-em-database-control" name="enterprise-manager-em-database-control"></a>
##  Enterprise Manager (EM) Database Control
Enterprise Manager Database Control 提供了一个基于 Web 的界面，您可以使用这个界面来管理 Oracle 实例和数据库。

要从客户端浏览器访问 Oracle Enterprise Manager Database Control，必须启动 dbconsole 进程。

首先检查OracleDbConsole有没有，

设置ORACLE 11g的ORACLE_HOSTNAME，命令为：C:\Windows\system32>set ORACLE_HOSTNAME=localhost

设置ORACLE 11g的ORACLE_UNQNAME，命令为：C:\Windows\system32>set ORACLE_UNQNAME=orcl

<a id="markdown-客户端的安装" name="客户端的安装"></a>
## 客户端的安装
客户端这里推荐安装32位的版本：【win32_11gR2_client.zip】

在win10安装会有此提示，可以忽略

![](..\assets\Oracle\oracle-client-win10.png)

进行客户端的默认安装

![](..\assets\Oracle\oracle-client-install-1.png)

![](..\assets\Oracle\oracle-client-install-2.png)

![](..\assets\Oracle\oracle-client-install-4.png)

![](..\assets\Oracle\oracle-client-install-5.png)

<a id="markdown-plsql-developer" name="plsql-developer"></a>
## PL/SQL developer 

打开PLSQL Developer，选择Tools -> perference -> Connection，配置其中的Oracle Home和OCI Library项，如下图所示：

Oracle Home：E:\app\Administrator\product\11.2.0\client_1

OCI Library：E:\app\Administrator\product\11.2.0\client_1\oci.dll

tsname.ora配置：

```sql
orcl =
  (DESCRIPTION =
    (ADDRESS_LIST =
      (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.0.60)(PORT = 1521))
    )
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = orcl)
    )
  )
```

<a id="markdown-疑难解答" name="疑难解答"></a>
## 疑难解答
<a id="markdown-ora-12541" name="ora-12541"></a>
### ORA-12541
连接Oracle时报错ORA-12541: TNS: 无监听程序

需要检查服务端的监听程序配置，【Net Configuration Assistant】检查本地网络服务名的配置。
